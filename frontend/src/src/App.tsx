import { useInterval } from './interval';
import { Col, Row, Table, Tag } from 'antd';
import React, { useEffect, useState } from 'react';
import UploadBar from './UploadBar';
import axios from 'axios';
import Moment from 'react-moment';

function App() {
  
  const [submissions, setSubmissions] = useState([]);
  const hostname = 'http://' + window.location.hostname + '/api/last_submissions';

  useEffect(() => {
    axios.get(hostname).then((response) => {
      setSubmissions(response.data);
    });
  }, []);

  useInterval(() => {
    axios.get(hostname).then((response) => {
      setSubmissions(response.data);
    });
  }, 15000);
  
  const columns = [
    {
      title: 'Date',
      dataIndex: 'date',
      key: 'date',
      render: (text : string) => <Moment format="MMM, DD hh:mm">{text}</Moment>,
    },
    {
      title: 'SHA256',
      dataIndex: 'sample_hash',
      key: 'sample_hash',
    },
    {
      title: 'Verdict',
      dataIndex: 'verdict',
      key: 'verdict',
      render: (text : string) => {
        let color;

        if (text === 'malware') {
          color = 'volcano'
        }
        else if(text === 'benign') {
          color = 'green'
        }
        else {
          color = 'geekblue'
        }
        return (
          <Tag color={color} key={text}>
            {text.toUpperCase()}
          </Tag>
        );
      }
    }
  ];

  return (
    <>
    <Row justify="center">
    <Col>
      <h1>Malware Experiment</h1>
    </Col>
    </Row>
    <Row justify="center">
    <Col>
      <h3>We detect malicious PE Files without executing them. This site is a work in progress. </h3>
      </Col>
    </Row>
    <UploadBar></UploadBar>
    <Row align="bottom" justify="center">
      <Col>
        <Table pagination={false} dataSource={submissions} columns={columns} />
      </Col>
    </Row>
    <Row justify="center">
      <Col>
        <span>Suggestions, doubts, curiosity? Send an email to <img src="/email.png"/>.</span>
      </Col>
    </Row>
    </>
  );
}

export default App;
