import { Upload, Button, Row, Col } from 'antd';
import { UploadOutlined, LoadingOutlined } from '@ant-design/icons';
import { message, Spin } from 'antd';
import React, { useState } from 'react';

export default function UploadBar() {
  const antIcon = <LoadingOutlined style={{ fontSize: 24 }} spin />;
  const [result, setResult] = useState("");
  const [loading, setLoading] = useState(false);
  const hostname = window.location.origin + '/api/submit';
  const props = {
    name: 'file',
    action: hostname,
    onChange(info: any) {
      if (info.file.status === 'uploading') {
        setResult("");
        setLoading(true);
      }
      else if (info.file.status === 'done') {
        setResult(info.file.response['result']);
        setLoading(false);
      } else if (info.file.status === 'error') {
        setResult("");
        setLoading(false);
        message.error("We currently only allow files smaller than 1 Mb.", 2);
      } else {
        setResult("");
        setLoading(false);
      }
    },
  };

  return (
      <>
      <Row justify="center">
        <Col>
        <Upload showUploadList={false} {...props}>
          <Button icon={<UploadOutlined />}>Submit PE File</Button>
        </Upload>
        </Col>
      </Row>
      <Row justify="center">
        <Col>
        {result !== '' && <span> The submitted file is {result}. </span>}
        {loading && <Spin indicator={antIcon} />}
        </Col>
      </Row>
      </>
  );
}